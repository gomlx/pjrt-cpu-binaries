#!/bin/bash
# Use the environment variable, or fallback to a global 'zig'
ZIG="${ZIG_EXE:-zig}"

# Target Amazon Linux 2023 compatibility
TARGET="-target x86_64-linux-gnu.2.34"

# Cache handling (Critical for Zig)
if [ -n "$ZIG_CACHE" ]; then
  CACHE_FLAGS="--cache-dir $ZIG_CACHE --global-cache-dir $ZIG_CACHE"
fi

# Silence warnings about unused flags (like -target during linking)
FLAGS="-Wno-unused-command-line-argument"

# Detection for configure.py (stdin check)
if [[ "${@: -1}" == "-" ]]; then
  exec "$ZIG" cc $TARGET $CACHE_FLAGS $FLAGS -x c++ "$@"
else
  exec "$ZIG" cc $TARGET $CACHE_FLAGS $FLAGS "$@"
fi
